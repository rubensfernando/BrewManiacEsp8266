# Audio prompt during brewing

The web interface can play audio to prompt progress of brewing. "**sounds.json**" is needed to specify the audio segments.

## sounds.json format
sounds.json should be in JSON format. It looks like

`
{"src":"sounds.m4a",
"seg":{
"open":{"s":0,"t":2.2,"r":1},
"tr":{"s":2.3,"t":1.5,"r":1},
"addhop":{"s":4,"t":1.2,"r":3},
"addmalt":{"s":5.5,"t":1.4,"r":1},
"boil":{"s":7.1,"t":1.2,"r":1},
"boilend":{"s":8.6,"t":1.2,"r":1},
"bye":{"s":10,"t":2,"r":1},
"chill":{"s":12,"t":1.2,"r":3},
"cool":{"s":13.5,"t":1.2,"r":2},
"iodine":{"s":15,"t":2,"r":3},
"maltin":{"s":17,"t":1.4,"r":3},
"mashout":{"s":18.5,"t":1.4,"r":1},
"nmash":{"s":20,"t":2,"r":1},
"removemalt":{"s":22,"t":1.6,"r":3},
"whirlpool":{"s":24,"t":1.3,"r":2},
"disc":{"s":25.5,"t":1.6,"r":2}}
}
`

**src** sepcifies the source of actual audio files, usually a mp3 or m4a file. It doesn't have to be a local file. You might specify any URL given that host supports CORS.

Each voice segments is defined as
`
"<nametag>":{"s":<starting pos>, "t":<duration>,"r":<repeat>}
`

**<starting pos>** specifies the relative postion, in seconds, of the audio segment in the file, while **<duration>** specifies the duration of the audio segment. **<repeat>** specifies the times to repeat the audio segment.
**<nametag>** list
|tag|meaning|
|--|--|
|open| played when the web page is opened.|
|tr| temperature reach |
|addhop| time to add hop |
|addmalt| time to add malt/dough-in |
|boil| boil starts |
|boilend | end of boiling |
|bye| brew complete |
|chill| Start to chill for hopstand |
|cool | Start to cool wort|
|iodine| time for iodine test|
|maltin| start heating striking water|
|mashout| start mash out |
|nmash | Next mash step |
|removemalt| remove spent malt or malt pipe(basket) |
|whirlpool|start whirlpool |
|disc| disconnected|

## Issues of Safari
There are two issues related Safari.
First, Safari doesn't automatically play audio. You will need to change the setting.  [Follow the instruction described here.](https://connection.nwea.org/s/article/Audio-does-not-play-automatically-in-Safari?language=en_US).

Second, Safari requests audio file in a special way that the web server used, ESPAsyncWebServer, doesn't support, which is "keeping connection alive". A workaround is place the audio file at other server.
## Example files
- sounds.m4a: example audio file generated by TTS engine of Mac,i.e. Siri.
- sounds.json: the json to be used with audio file above.
- sounds.github.json: The JSON file that use the audio file above directly.

If you don't use Safari, uploading sounds.m4a & sounds.json to BM via filemanager should do the job. For Safari users as well as all others, uploading the sounds.github.json to be sounds.json might work. Access to github.com is necessary since the audio file is accessed directly from here, on github.com 

